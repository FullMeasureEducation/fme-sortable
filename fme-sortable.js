// Generated by CoffeeScript 1.9.2
(function() {
  angular.module('fme-sortable', []).directive('fmeSortable', function($log, $timeout) {
    return {
      restrict: 'A',
      scope: {
        fmeList: '=',
        fmeIndex: '=',
        fmeOnDrop: '&',
        fmeNotSortable: '&'
      },
      link: function(scope, element, attrs) {
        var dragging_index;
        if (!scope.fmeNotSortable()) {
          element.attr('draggable', 'true');
          dragging_index = null;
          element.on('dragstart', function(event) {
            var e;
            dragging_index = scope.fmeIndex;
            e = event.originalEvent != null ? event.originalEvent : event;
            return e.dataTransfer.setData('text/plain', dragging_index);
          });
          element.on('dragover', function(event) {
            var e;
            e = event.originalEvent != null ? event.originalEvent : event;
            e.preventDefault();
            if (scope.fmeIndex !== dragging_index) {
              element.addClass('dropzone');
              return e.dataTransfer.dropEffect = 'move';
            }
          });
          element.on('dragleave', function(event) {
            return element.removeClass('dropzone');
          });
          return element.on('drop', function(event) {
            var dropped_fmeIndex, dropped_model, e;
            e = event.originalEvent != null ? event.originalEvent : event;
            dropped_fmeIndex = e.dataTransfer.getData('text/plain');
            dropped_model = scope.fmeList[dropped_fmeIndex];
            element.removeClass('dropzone');
            return $timeout(function() {
              scope.fmeList.splice(dropped_fmeIndex, 1);
              scope.fmeList.splice(scope.fmeIndex, 0, dropped_model);
              return scope.fmeOnDrop();
            });
          });
        }
      }
    };
  });

}).call(this);
